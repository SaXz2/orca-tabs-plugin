# Orca Tabs Plugin - 标签排序固定功能

## 已实现功能

### 1. 标签排序固定
- ✅ **固定标签在前，非固定在后**：固定标签会自动排序到标签栏的最前面
- ✅ **双击标签切换固定状态**：双击任意标签可以切换其固定/非固定状态
- ✅ **快捷键切换固定状态**：使用 `Ctrl+P` (或 `Cmd+P`) 可以切换当前激活标签的固定状态
- ✅ **固定标签置顶显示**：固定标签会显示 📌 图标，并在标签栏最前面显示

### 2. 关闭标签页功能
- ✅ **Ctrl+点击关闭**：按住 Ctrl 键点击标签可以关闭该标签
- ✅ **中键点击关闭**：使用鼠标中键点击标签可以关闭该标签
- ✅ **右键菜单**：右键点击标签显示上下文菜单，包含：
  - 固定/取消固定标签
  - 关闭标签
  - 关闭其他标签
  - 关闭全部标签

### 3. 智能关闭逻辑
- ✅ **固定标签保护**：固定标签默认不可关闭，需要强制关闭
- ✅ **关闭全部保护**：执行"关闭全部"操作时，固定标签会被保留
- ✅ **关闭其他保护**：执行"关闭其他"操作时，当前标签和固定标签会被保留
- ✅ **单标签保护**：当只有一个标签时，无法关闭该标签

### 4. 视觉标识
- ✅ **固定标签图标**：固定标签显示 📌 图标
- ✅ **悬停提示**：鼠标悬停在固定标签上会显示"(已固定)"提示
- ✅ **右键菜单**：美观的右键菜单，支持悬停效果

### 5. 数据持久化
- ✅ **状态保存**：标签的固定状态会保存到本地存储
- ✅ **排序保存**：标签的排序顺序会保存到本地存储
- ✅ **跨会话保持**：重新加载页面后，固定状态和排序会保持

## 使用方法

### 固定标签
1. **双击标签**：双击任意标签可以切换固定状态
2. **快捷键**：在标签激活状态下按 `Ctrl+P` (Windows/Linux) 或 `Cmd+P` (Mac)
3. **右键菜单**：右键点击标签，选择"固定标签"或"取消固定"

### 关闭标签
1. **Ctrl+点击**：按住 Ctrl 键点击标签
2. **中键点击**：使用鼠标中键点击标签
3. **右键菜单**：右键点击标签，选择相应的关闭选项

### 批量操作
- **关闭全部**：右键菜单选择"关闭全部标签"（保留固定标签）
- **关闭其他**：右键菜单选择"关闭其他标签"（保留当前标签和固定标签）

## 技术实现

### 核心数据结构
```typescript
interface TabInfo {
  blockId: string;
  panelId: string;
  title: string;
  color?: string;
  icon?: string;
  isJournal?: boolean;
  isPinned?: boolean;  // 新增：固定状态
  order: number;
}
```

### 关键方法
- `sortTabsByPinStatus()`: 按固定状态排序标签
- `toggleTabPinStatus()`: 切换标签固定状态
- `closeTab()`: 关闭标签页
- `closeAllTabs()`: 关闭全部标签（保留固定标签）
- `closeOtherTabs()`: 关闭其他标签（保留当前和固定标签）
- `showTabContextMenu()`: 显示右键菜单

### 事件处理
- 双击事件：切换固定状态
- Ctrl+点击：关闭标签
- 中键点击：关闭标签
- 右键点击：显示上下文菜单
- 键盘快捷键：`Ctrl+P` 切换固定状态

## 兼容性
- ✅ 支持 Windows、macOS、Linux
- ✅ 支持多面板环境
- ✅ 与现有拖拽排序功能兼容
- ✅ 与现有标签页功能完全兼容

## 注意事项
1. 固定功能仅在第一个面板中有效
2. 固定标签在"关闭全部"操作中会被保留
3. 只有一个标签时无法关闭
4. 所有状态变更都会自动保存到本地存储
