# 自动切换到相邻标签功能测试

## 功能描述
当关闭当前激活的标签时，自动切换到相邻标签，考虑各种极端情况：
- 在中间关闭：激活右边的标签
- 在最右边关闭：激活左边的标签  
- 在最左边关闭：激活右边的标签

## 实现的方法

### 1. `getCurrentActiveTab(): TabInfo | null`
- 获取当前激活的标签
- 通过DOM查询找到第一个面板中当前激活的块编辑器
- 在固化标签列表中查找对应的标签

### 2. `getAdjacentTab(currentTab: TabInfo): TabInfo | null`
- 获取相邻标签的逻辑：
  - 如果当前标签在中间位置，优先选择右边的标签
  - 如果当前标签在最右边，选择左边的标签
  - 如果当前标签在最左边，选择右边的标签
  - 如果只有一个标签，返回null（无法切换）

### 3. 修改的 `closeTab(tab: TabInfo)` 方法
- 在关闭标签前检查是否为当前激活的标签
- 如果是激活标签，获取相邻标签
- 关闭标签后自动切换到相邻标签

## 测试场景

### 场景1：只有一个标签
- **预期行为**：无法关闭（原有逻辑保持不变）
- **测试方法**：尝试关闭唯一的标签
- **预期结果**：显示"只有一个标签，无法关闭"的警告

### 场景2：两个标签
- **情况2.1**：关闭左边的标签
  - **预期行为**：自动切换到右边的标签
- **情况2.2**：关闭右边的标签  
  - **预期行为**：自动切换到左边的标签

### 场景3：三个或更多标签
- **情况3.1**：关闭中间的标签
  - **预期行为**：自动切换到右边的标签
- **情况3.2**：关闭最左边的标签
  - **预期行为**：自动切换到右边的标签
- **情况3.3**：关闭最右边的标签
  - **预期行为**：自动切换到左边的标签

### 场景4：关闭非激活标签
- **预期行为**：正常关闭，不进行自动切换
- **测试方法**：先切换到其他标签，然后关闭非激活的标签

### 场景5：固定标签
- **预期行为**：固定标签的关闭逻辑保持不变，如果关闭固定标签且它是激活的，也会自动切换

## 测试步骤

1. **准备测试环境**
   - 确保插件已加载
   - 在第一个面板中打开多个标签页

2. **测试单个标签**
   - 只保留一个标签
   - 尝试关闭（中键点击或右键菜单）
   - 验证无法关闭

3. **测试两个标签**
   - 打开两个标签页
   - 分别测试关闭左边和右边的标签
   - 验证自动切换行为

4. **测试多个标签**
   - 打开3个或更多标签页
   - 测试关闭中间、最左边、最右边的标签
   - 验证自动切换行为

5. **测试非激活标签关闭**
   - 切换到非激活标签
   - 关闭其他标签
   - 验证不会自动切换

6. **测试固定标签**
   - 固定一些标签
   - 测试关闭固定标签的行为

## 预期日志输出

### 正常关闭激活标签
```
🔄 自动切换到相邻标签: "标签名称"
🗑️ 标签 "被关闭的标签" 已关闭，已添加到关闭列表
```

### 关闭激活标签但无相邻标签
```
⚠️ 关闭了激活标签但没有相邻标签可切换
🗑️ 标签 "被关闭的标签" 已关闭，已添加到关闭列表
```

### 关闭非激活标签
```
🗑️ 标签 "被关闭的标签" 已关闭，已添加到关闭列表
```

## 注意事项

1. **只有第一个面板支持此功能**：其他面板的标签关闭行为保持不变
2. **保持原有逻辑**：非激活标签的关闭行为不受影响
3. **固定标签处理**：固定标签的关闭逻辑保持不变
4. **性能考虑**：使用现有的DOM查询方法，不会显著影响性能

## 实现细节

- 使用 `getCurrentActiveTab()` 检测当前激活标签
- 使用 `getAdjacentTab()` 获取相邻标签
- 在 `closeTab()` 方法中集成自动切换逻辑
- 保持向后兼容性，不影响现有功能
