# Orca Tabs 插件使用文档

## 插件简介

Orca Tabs 为单面板模式提供类似浏览器的标签栏，直观展示当前面板中打开的缓存页，并支持点击切换。插件自动适配浅色/深色主题，并避免与悬浮窗（如块预览）交互产生闪烁。

当前版本不提供“关闭标签”功能（已按要求移除），仅用于显示与切换。

## 功能点

- 在 `.orca-panel` 顶部渲染标签栏，显示当前面板下所有 `.orca-hideable` 缓存页
- 仅在“主界面单面板”情况下启用（忽略 `.orca-popup` 内面板，多个主面板时自动禁用）
- 标签标题来源：
  - 优先使用后端 `get-blocks` 的 `text`
  - 若标题为空且识别为日志页（`.orca-block.orca-container[data-type="journal"]`），从 `.orca-repr-main-content` 中读取“📅 图标 + 紧随文本”（跳过两侧箭头按钮）
- 点击标签即可切换对应页
- 自动忽略 `.orca-popup`（如 `.orca-block-preview`）中的 DOM 变化，避免闪烁
- 主题适配：
  - 浅色模式：未选中更暗、选中更亮（透明灰与浅灰背景）
  - 深色/黑色背景：未选中略亮、选中更亮（白色半透明背景）

## 安装与启用

1. 将插件放入 Orca 插件目录（如 `~/.orca/plugins/orca-tabs-plugin`）
2. 运行构建（开发者）：
   - 安装依赖：`npm install`
   - 构建：`npm run build`
3. 在 Orca 设置中启用插件（或重启 Orca 让插件自动加载）

## 使用说明

- 保持单面板布局（`.orca-panel` 主区域仅一个）。若主区域存在多个面板，插件会自动禁用标签栏。
- 打开页面后，标签栏会自动出现；点击标签即可切换。
- 日志页面会自动显示形如“📅 2025年9月11日”的标签标题。

## 可用命令

插件注册了部分命令（供自动化/调试）：

```ts
// 列出当前激活面板的标签
await orca.commands.invokeCommand("orca-tabs-plugin.tabs.list")

// 切换到下/上一个面板（系统命令透传）
await orca.commands.invokeCommand("orca-tabs-plugin.tabs.switchNext")
await orca.commands.invokeCommand("orca-tabs-plugin.tabs.switchPrev")

// 关闭除当前面板外的其他面板（系统命令透传）
await orca.commands.invokeCommand("orca-tabs-plugin.tabs.closeOthers")
```

说明：标签关闭相关命令与 UI 已移除。

## 样式自定义

插件会注入基础样式（不强制背景/边框），你可在 `custom.css` 中覆写：

```css
/* 标签按钮统一去边框 */
.orca-tab { border: none; }

/* 示例：自定义浅色与深色选中/非选中背景 */
@media (prefers-color-scheme: light) {
  .orca-tab { background: rgba(0,0,0,0.06); }
  .orca-tab.is-active { background: #e5e7eb; }
}
@media (prefers-color-scheme: dark) {
  .orca-tab { background: rgba(255,255,255,0.06); }
  .orca-tab.is-active { background: rgba(255,255,255,0.12); }
}
```

## 兼容性与注意事项

- 插件会主动忽略 `.orca-popup` 范围内的一切内容（包括其中的 `.orca-panel`），以避免悬浮窗显示/变化导致标签栏闪烁或被误判为多面板。
- 标签标题依赖 DOM 结构与后端 API；若你的主题对日志页结构有较大改动，可反馈选择器以做适配。
- 若你需要恢复“关闭标签”功能，请提供内置关闭按钮的选择器或触发命令，我们将基于内置流程实现，避免破坏缓存编辑器状态。

## 常见问题（FAQ）

1) 标签栏不显示？
   - 检查主区域是否存在多个面板；仅在单面板模式下显示
   - 确认不是在 `.orca-popup` 悬浮层中

2) 日志标题不正确？
   - 提供实际 DOM 片段（`.orca-repr-main-content` 节点），以便完善选择器

3) 性能问题？
   - 已对刷新做小节流，并过滤无关变更；如仍有卡顿，反馈具体场景以优化


